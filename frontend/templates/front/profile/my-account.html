{% extends "front/base.html" %}
{% load static %}

{% block custom_css %}
<style>
    .tab-vertical .nav-product {
        position: relative;
        padding-left: 2.2rem;
        padding-right: 2rem;
        text-align: left;
        width: 100%;
        margin-bottom: 0.5rem;
    }
    .nav-product {
        display: block;
        position: relative;
        font-size: 1.4rem;
        font-weight: 600;
        color: inherit;
        line-height: 1;
        letter-spacing: 0;
        text-align: center;
        text-transform: uppercase;
        border-radius: 0;
        border: 0;
        padding: 1.5rem 2.85rem;
        -webkit-transition: border 0.3s, color 0.3s, background-color 0.3s;
        transition: border 0.3s, color 0.3s, background-color 0.3s;
    }

    /* Message Styling */
    .message-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        max-width: 400px;
        width: 100%;
    }
    
    .alert {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        padding: 15px 20px;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border: none;
        color: white;
        opacity: 0;
        transform: translateY(-20px);
        animation: slideIn 0.5s forwards;
    }
    
    @keyframes slideIn {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .alert-success {
        background-color: #28a745;
    }
    
    .alert-error {
        background-color: #dc3545;
    }
    
    .alert-warning {
        background-color: #ffc107;
        color: #212529;
    }
    
    .alert-info {
        background-color: #17a2b8;
    }
    
    .btn-close {
        background: transparent;
        border: none;
        color: inherit;
        font-size: 1.2rem;
        cursor: pointer;
        padding: 0;
        margin-left: 15px;
        opacity: 0.8;
        transition: opacity 0.2s;
    }
    
    .btn-close:hover {
        opacity: 1;
    }

    /* DataTables Styling */
    .dataTables_wrapper .dataTables_paginate .paginate_button {
        padding: 0.3em 0.8em;
        margin-left: 2px;
        border: 1px solid #e5e7eb;
    }
    .dataTables_wrapper .dataTables_paginate .paginate_button.current {
        background: #f97316;
        color: white !important;
        border: 1px solid #f97316;
    }
    .nav-product.disabled {
        pointer-events: none;
        opacity: 0.5;
    }
</style>

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
{% endblock custom_css %}

{% block content %}
<!-- Message Display Section -->
{% if messages %}
<div class="message-container">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }}" role="alert">
        <div class="alert-content">
            <span>{{ message }}</span>
        </div>
        <button type="button" class="btn-close" onclick="this.parentElement.style.display='none'">&times;</button>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Start of Breadcrumb -->
<nav class="breadcrumb-nav">
    <div class="container">
        <ul class="breadcrumb">
            <li><a href="demo1.html">Home</a></li>
            <li>My account</li>
        </ul>
    </div>
</nav>
<!-- End of Breadcrumb -->

<!-- Start of PageContent -->
<div class="page-content pt-2">
    <div class="container">
        <div class="tab tab-vertical row gutter-lg">
            <ul class="nav nav-tabs mb-6" role="tablist">
                <li class="nav-item">
                    <a href="#account-dashboard" class="nav-link active">Dashboard</a>
                </li>
                <li class="nav-item">
                    <a href="#account-orders" class="nav-link">Orders</a>
                </li>
                
                {% if can_upload %}
                    <li class="nav-item">
                    <a href="{% url 'create_customer_product' %}" class="nav-product">Add Products</a>
                    </li>
                    {% else %}
                    <li class="nav-item">
                    <span class="nav-product disabled" aria-disabled="true">Add Products</span>
                    </li>
                    <div class="alert alert-warning mt-2">
                        Update Or Buy a package â€” your commonly 2-product limit is finished.
                    </div>
                    {% endif %}

                <li class="nav-item">
                    <a href="#account-products" class="nav-link">Products</a>
                </li>
                
                <li class="nav-item">
                    <a href="wishlist.html">Wishlist</a>
                </li>
                <li class="nav-item">
                    <a href="wishlist.html">My Products</a>
                </li>

                <li class="nav-item">
                    <a href="{% url 'logout_user' %}">Logout</a>
                </li>
            </ul>

            <div class="tab-content mb-6">
                <div class="tab-pane active in" id="account-dashboard">
                    <p class="greeting">
                        Hello
                        <span class="text-dark font-weight-bold">{{request.user.username}}</span>
                        
                        <a href="{% url 'logout_user' %}">Logout</a>
                    </p>

                    <p class="mb-4">
                        From your account dashboard you can view your <a href="#account-orders"
                            class="text-primary link-to-tab">recent orders</a>,
                        manage your <a href="#account-addresses" class="text-primary link-to-tab">shipping
                            and billing
                            addresses</a>, and
                        <a href="#account-details" class="text-primary link-to-tab">edit your password and
                            account details.</a>
                    </p>

                    <div class="row">
                        <div class="col-lg-4 col-md-6 col-sm-4 col-xs-6 mb-4">
                            <a href="#account-orders" class="link-to-tab">
                                <div class="icon-box text-center">
                                    <span class="icon-box-icon icon-orders">
                                        <i class="w-icon-orders"></i>
                                    </span>
                                    <div class="icon-box-content">
                                        <p class="text-uppercase mb-0">Orders</p>
                                    </div>
                                </div>
                            </a>
                        </div>
                        <div class="col-lg-4 col-md-6 col-sm-4 col-xs-6 mb-4">
                            <a href="#account-downloads" class="link-to-tab">
                                <div class="icon-box text-center">
                                    <span class="icon-box-icon icon-download">
                                        <i class="w-icon-download"></i>
                                    </span>
                                    <div class="icon-box-content">
                                        <p class="text-uppercase mb-0">Downloads</p>
                                    </div>
                                </div>
                            </a>
                        </div>
                        <div class="col-lg-4 col-md-6 col-sm-4 col-xs-6 mb-4">
                            <a href="#account-addresses" class="link-to-tab">
                                <div class="icon-box text-center">
                                    <span class="icon-box-icon icon-address">
                                        <i class="w-icon-map-marker"></i>
                                    </span>
                                    <div class="icon-box-content">
                                        <p class="text-uppercase mb-0">Addresses</p>
                                    </div>
                                </div>
                            </a>
                        </div>
                        <div class="col-lg-4 col-md-6 col-sm-4 col-xs-6 mb-4">
                            <a href="#account-details" class="link-to-tab">
                                <div class="icon-box text-center">
                                    <span class="icon-box-icon icon-account">
                                        <i class="w-icon-user"></i>
                                    </span>
                                    <div class="icon-box-content">
                                        <p class="text-uppercase mb-0">Account Details</p>
                                    </div>
                                </div>
                            </a>
                        </div>
                        <div class="col-lg-4 col-md-6 col-sm-4 col-xs-6 mb-4">
                            <a href="wishlist.html" class="link-to-tab">
                                <div class="icon-box text-center">
                                    <span class="icon-box-icon icon-wishlist">
                                        <i class="w-icon-heart"></i>
                                    </span>
                                    <div class="icon-box-content">
                                        <p class="text-uppercase mb-0">Wishlist</p>
                                    </div>
                                </div>
                            </a>
                        </div>

                        <div class="col-lg-4 col-md-6 col-sm-4 col-xs-6 mb-4">
                            <a href="{% url 'logout_user' %}">
                                <div class="icon-box text-center">
                                    <span class="icon-box-icon icon-logout">
                                        <i class="w-icon-logout"></i>
                                    </span>
                                    <div class="icon-box-content">
                                        <a href="{% url 'logout_user' %}">Logout</a>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>

                <div class="tab-pane mb-4" id="account-products">
                    <div class="icon-box icon-box-side icon-box-light">
                        <span class="icon-box-icon icon-orders">
                            <i class="w-icon-orders"></i>
                        </span>
                        <div class="icon-box-content">
                            <h4 class="icon-box-title text-capitalize ls-normal mb-0">My Products</h4>
                        </div>
                    </div>
                
                    <div class="table-responsive">
                        <table id="productsTable" class="display" style="width:100%">
                            <thead>
                                <tr>
                                    <th class="product-sku">SKU</th>
                                    <th class="product-title">Title</th>
                                    <th class="product-price">Price</th>
                                    <th class="product-category">Category</th>
                                    <th class="product-status">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for product in products %}
                                <tr>
                                    <td class="product-sku">{{ product.sku }}</td>
                                    <td class="product-title">
                                        <a href="{% url 'product_details' product.slug %}">{{ product.title }}</a>
                                    </td>
                                    <td class="product-price">
                                        ${{ product.selling_price|floatformat:2 }}
                                    </td>
                                    <td class="product-category">
                                        {{ product.category.name }}
                                    </td>
                                    <td class="product-status">
                                        <span class="badge {% if product.publish_status == 1 %}badge-success{% else %}badge-secondary{% endif %}">
                                            {% if product.publish_status == 1 %}Published{% else %}Draft{% endif %}
                                        </span>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="5" class="text-center">You haven't uploaded any products yet.</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="tab-pane mb-4" id="account-orders">
                    <div class="icon-box icon-box-side icon-box-light">
                        <span class="icon-box-icon icon-orders">
                            <i class="w-icon-orders"></i>
                        </span>
                        <div class="icon-box-content">
                            <h4 class="icon-box-title text-capitalize ls-normal mb-0">Orders</h4>
                        </div>
                    </div>
                
                    <div class="table-responsive">
                        <table id="ordersTable" class="display table dataTable" style="width:100%">
                            <thead>
                                <tr>
                                    <th class="order-id">Order #</th>
                                    <th class="order-date">Date</th>
                                    <th class="order-status">Status</th>
                                    <th class="order-total">Total</th>
                                    <th class="order-actions">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for order in orders %}
                                <tr>
                                    <td class="order-id">#{{ order.order_number }}</td>
                                    <td class="order-date" data-order="{{ order.created_at|date:'Y-m-d' }}">
                                        {{ order.created_at|date:"F d, Y" }}
                                    </td>
                                    <td class="order-status">
                                        <span class="status-badge status-{{ order.get_status_display|lower }}">
                                            {{ order.get_status_display }}
                                        </span>
                                    </td>
                                    <td class="order-total" data-order="{{ order.grand_total }}">
                                        ${{ order.grand_total|floatformat:2 }}
                                    </td>
                                    <td class="order-action" style="box-sizing: inherit;">
                                        <a href="#" class="btn btn-outline btn-default btn-block btn-sm btn-rounded">View</a>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="5" class="text-center">You haven't placed any orders yet.</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="tab-pane" id="account-downloads">
                    <div class="icon-box icon-box-side icon-box-light">
                        <span class="icon-box-icon icon-downloads mr-2">
                            <i class="w-icon-download"></i>
                        </span>
                        <div class="icon-box-content">
                            <h4 class="icon-box-title ls-normal">Downloads</h4>
                        </div>
                    </div>
                    <p class="mb-4">No downloads available yet.</p>
                    <a href="shop-banner-sidebar.html" class="btn btn-dark btn-rounded btn-icon-right">Go
                        Shop<i class="w-icon-long-arrow-right"></i></a>
                </div>

                <div class="tab-pane" id="account-addresses">
                    <div class="icon-box icon-box-side icon-box-light">
                        <span class="icon-box-icon icon-map-marker">
                            <i class="w-icon-map-marker"></i>
                        </span>
                        <div class="icon-box-content">
                            <h4 class="icon-box-title mb-0 ls-normal">Addresses</h4>
                        </div>
                    </div>
                    <p>The following addresses will be used on the checkout page
                        by default.</p>
                    <div class="row">
                        <div class="col-sm-6 mb-6">
                            <div class="ecommerce-address billing-address pr-lg-8">
                                <h4 class="title title-underline ls-25 font-weight-bold">Billing Address</h4>
                                <address class="mb-4">
                                    <table class="address-table">
                                        <tbody>
                                            <tr>
                                                <th>Name:</th>
                                                <td>{{request.user.username}}</td>
                                            </tr>
        
                                            <tr>
                                                <th>Address:</th>
                                                <td>{{request.user.address}}</td>
                                            </tr>
                                            <tr>
                                                <th>City:</th>
                                                <td>{{request.user.city}}</td>
                                            </tr>
                                           
                                            <tr>
                                                <th>Postcode:</th>
                                                <td>{{request.user.postal_code}}</td>
                                            </tr>
                                            <tr>
                                                <th>Phone:</th>
                                                <td>{{request.user.phone_number}}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </address>
                                <a href="#"
                                    class="btn btn-link btn-underline btn-icon-right text-primary">Edit
                                    your billing address<i class="w-icon-long-arrow-right"></i></a>
                            </div>
                        </div>
                        <div class="col-sm-6 mb-6">
                            <div class="ecommerce-address shipping-address pr-lg-8">
                                <h4 class="title title-underline ls-25 font-weight-bold">Shipping Address</h4>
                                <address class="mb-4">
                                    <table class="address-table">
                                        <tbody>
                                            <tr>
                                                <th>Name:</th>
                                                <td>John Doe</td>
                                            </tr>
                                            <tr>
                                                <th>Company:</th>
                                                <td>Conia</td>
                                            </tr>
                                            <tr>
                                                <th>Address:</th>
                                                <td>Wall Street</td>
                                            </tr>
                                            <tr>
                                                <th>City:</th>
                                                <td>California</td>
                                            </tr>
                                            <tr>
                                                <th>Country:</th>
                                                <td>United States (US)</td>
                                            </tr>
                                            <tr>
                                                <th>Postcode:</th>
                                                <td>92020</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </address>
                                <a href="#"
                                    class="btn btn-link btn-underline btn-icon-right text-primary">Edit your
                                    shipping address<i class="w-icon-long-arrow-right"></i></a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane" id="account-details">
                    <div class="icon-box icon-box-side icon-box-light">
                        <span class="icon-box-icon icon-account mr-2">
                            <i class="w-icon-user"></i>
                        </span>
                        <div class="icon-box-content">
                            <h4 class="icon-box-title mb-0 ls-normal">Account Details</h4>
                        </div>
                    </div>
                
                    <form class="form account-details-form" action="{% url 'update_account_details' %}" method="post">
                        {% csrf_token %}
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="firstname">First Name *</label>
                                    <input type="text" id="firstname" name="firstname" value="{{ request.user.first_name }}" class="form-control form-control-md">
                                </div>
                            </div>
                
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="lastname">Last Name *</label>
                                    <input type="text" id="lastname" name="lastname" value="{{ request.user.last_name }}" class="form-control form-control-md">
                                </div>
                            </div>
                        </div>
                
                        <div class="form-group mb-3">
                            <label for="display-name">Display Name *</label>
                            <input type="text" id="display-name" name="display_name" value="{{ request.user.username }}" class="form-control form-control-md mb-0">
                            <p>This will be how your name will be displayed in the account section and in reviews</p>
                        </div>
                
                        <div class="form-group mb-3">
                            <label for="email_1">Email Address *</label>
                            <input type="email" id="email_1" name="email_1" value="{{ request.user.email }}" class="form-control form-control-md">
                        </div>
                
                        <div class="form-group mb-3">
                            <label for="phone_number">Phone Number</label>
                            <input type="text" id="phone_number" name="phone_number" value="{{ request.user.phone_number }}" class="form-control form-control-md">
                        </div>
                
                        <div class="form-group mb-3">
                            <label for="address">Address</label>
                            <input type="text" id="address" name="address" value="{{ request.user.address }}" class="form-control form-control-md">
                        </div>
                
                        <div class="form-group mb-3">
                            <label for="city">City</label>
                            <input type="text" id="city" name="city" value="{{ request.user.city }}" class="form-control form-control-md">
                        </div>
                
                        <div class="form-group mb-3">
                            <label for="state">State</label>
                            <input type="text" id="state" name="state" value="{{ request.user.state }}" class="form-control form-control-md">
                        </div>
                
                        <div class="form-group mb-6">
                            <label for="postal_code">Postal Code</label>
                            <input type="text" id="postal_code" name="postal_code" value="{{ request.user.postal_code }}" class="form-control form-control-md">
                        </div>
                
                        <h4 class="title title-password ls-25 font-weight-bold">Password Change</h4>
                
                        <div class="form-group">
                            <label class="text-dark" for="cur-password">Current Password (leave blank to keep unchanged)</label>
                            <input type="password" class="form-control form-control-md" id="cur-password" name="cur_password">
                        </div>
                
                        <div class="form-group">
                            <label class="text-dark" for="new-password">New Password (leave blank to keep unchanged)</label>
                            <input type="password" class="form-control form-control-md" id="new-password" name="new_password">
                        </div>
                
                        <div class="form-group mb-10">
                            <label class="text-dark" for="conf-password">Confirm New Password</label>
                            <input type="password" class="form-control form-control-md" id="conf-password" name="conf_password">
                        </div>
                
                        <button type="submit" class="btn btn-dark btn-rounded btn-sm mb-4">Save Changes</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End of PageContent -->
{% endblock content %}

{% block custom_js %}
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script>
    $(document).ready(function() {
        

        // Products Table
        $('#productsTable').DataTable({
            "pageLength": 10,
            "lengthMenu": [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
            "responsive": true,
            "language": {
                "search": "_INPUT_",
                "searchPlaceholder": "Search products...",
                "lengthMenu": "Show _MENU_ entries",
                "paginate": {
                    "previous": "&laquo;",
                    "next": "&raquo;"
                }
            }
        });

        // Orders Table
        $('#ordersTable').DataTable({
            "pageLength": 10,
            "lengthMenu": [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
            "responsive": true,
            "language": {
                "search": "_INPUT_",
                "searchPlaceholder": "Search orders...",
                "lengthMenu": "Show _MENU_ entries",
                "paginate": {
                    "previous": "&laquo;",
                    "next": "&raquo;"
                }
            },
            "order": [[1, "desc"]] // Default sort by date (column index 1) descending
        });
    });
</script>
{% endblock custom_js %}