{% extends 'base.html' %}
{% load static %}

{% block css %}
<link rel="stylesheet" href="{% static 'assets/css/vendors/sweetalert2.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/vendors/select/bootstrap-select.min.css' %}">

<style>
/* Scoped styles only for this page */
#contact-messages-admin .modal-content {
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    border: none;
    overflow: hidden;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

#contact-messages-admin .modal-header {
    background: linear-gradient(135deg, #4a90e2, #357ABD);
    color: white;
    border-bottom: none;
    padding: 1rem 1.5rem;
    justify-content: space-between;
}

#contact-messages-admin .modal-title {
    font-weight: 700;
    font-size: 1.25rem;
}

#contact-messages-admin .close {
    color: black;
    background-color: transparent;
    
    font-size: 1.5rem;
    font-weight: 700;
    text-shadow: none;
    border: none;
}

#contact-messages-admin .modal-body {
    padding: 1.5rem 2rem;
    font-size: 1rem;
    color: #333;
    line-height: 1.5;
}

#contact-messages-admin hr {
    border-color: #ddd;
    margin: 1rem 0;
}

#contact-messages-admin .btn-close-modal {
    background: #357ABD;
    color: white;
    border: none;
    padding: 0.5rem 1.25rem;
    border-radius: 6px;
    font-weight: 600;
    transition: background-color 0.3s ease;
}

#contact-messages-admin .btn-close-modal:hover {
    background: #2a5d94;
    color: #fff;
}
</style>
{% endblock %}

{% block content %}
<div id="contact-messages-admin" class="container-fluid">
    <div class="row">
        <div class="col-lg-12">
            <h4 class="mb-4">Contact Messages</h4>

            {% if messages %}
                <div class="table-responsive">
                    <table class="table table-bordered table-striped">
                        <thead class="thead-dark">
                            <tr>
                                <th>#</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Submitted At</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for msg in messages %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>{{ msg.name }}</td>
                                <td>{{ msg.email }}</td>
                                <td>{{ msg.phone }}</td>
                                <td>{{ msg.created_at|date:"Y-m-d H:i" }}</td>
                                <td>
                                    <!-- View Button (Modal trigger) -->
                                    <button type="button" class="btn btn-sm btn-primary" data-toggle="modal" data-target="#viewModal{{ msg.id }}">
                                        View
                                    </button>

                                    <!-- Delete Button (form POST) -->
                                    <form method="post" action="{% url 'delete_contact_message' msg.id %}" style="display:inline;">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this message?');">
                                            Delete
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- Modals outside the table -->
                {% for msg in messages %}
                <div class="modal fade" id="viewModal{{ msg.id }}" tabindex="-1" role="dialog" aria-labelledby="viewModalLabel{{ msg.id }}" aria-hidden="true">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="viewModalLabel{{ msg.id }}">Message from {{ msg.name }}</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body">
                        <p><strong>Email:</strong> {{ msg.email }}</p>
                        <p><strong>Phone:</strong> {{ msg.phone|default:"-" }}</p>
                        <p><strong>Submitted At:</strong> {{ msg.created_at|date:"Y-m-d H:i" }}</p>
                        <hr>
                        <p>{{ msg.message|linebreaks }}</p>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-close-modal" data-dismiss="modal">Close</button>
                      </div>
                    </div>
                  </div>
                </div>
                {% endfor %}

            {% else %}
                <div class="alert alert-warning">No contact messages yet.</div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scriptcontent %}
<script src="{% static 'assets/js/sweet-alert/sweetalert.min.js' %}"></script>
<script src="{% static 'assets/js/form-validation-custom.js' %}"></script>
<script src="{% static 'assets/js/bookmark/jquery.validate.min.js' %}"></script>
<script src="{% static 'assets/js/select/bootstrap-select.min.js' %}"></script>

<!-- jQuery and Bootstrap JS for modal functionality -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
